(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _set=function set(object,property,value,receiver){var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent!==null){set(parent,property,value,receiver)}}else if("value"in desc&&desc.writable){desc.value=value}else{var setter=desc.set;if(setter!==undefined){setter.call(receiver,value)}}return value};var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var _scene=scene,Component=_scene.Component,RectPath=_scene.RectPath,Shape=_scene.Shape;var NATURE={mutable:false,resizable:true,rotatable:true,properties:[{type:"string",label:"target-map",name:"targetMap",property:"targetMap"},{type:"number",label:"latitude",name:"lat",property:"lat"},{type:"number",label:"longitude",name:"lng",property:"lng"}],"value-property":"latlng"};var GMapMarker=function(_RectPath){_inherits(GMapMarker,_RectPath);function GMapMarker(){_classCallCheck(this,GMapMarker);return _possibleConstructorReturn(this,(GMapMarker.__proto__||Object.getPrototypeOf(GMapMarker)).apply(this,arguments))}_createClass(GMapMarker,[{key:"dispose",value:function dispose(){var map=this.findMap();map&&map.removeMarker(this);delete this._infoWindow;delete this._marker;_get(GMapMarker.prototype.__proto__||Object.getPrototypeOf(GMapMarker.prototype),"dispose",this).call(this)}},{key:"ready",value:function ready(){_get(GMapMarker.prototype.__proto__||Object.getPrototypeOf(GMapMarker.prototype),"ready",this).call(this);var map=this.findMap();map&&map.addMarker(this)}},{key:"findInfoWindow",value:function findInfoWindow(type){var event=this.model.event;var infoWindow=event&&event[type]&&event[type].infoWindow;if(infoWindow)return this.root.findById(infoWindow)}},{key:"setInfoContent",value:function setInfoContent(sceneInfoWindow){var tpl=Component.template(sceneInfoWindow.model.frontSideTemplate);var content="<style>"+sceneInfoWindow.model.style+"</style>"+tpl(this);this.infoWindow.setContent(content)}},{key:"openInfoWindow",value:function openInfoWindow(iw){this.setInfoContent(iw);var map=this.findMap();if(!map||!map.map)return;this.infoWindow.open(map.map,this._marker)}},{key:"onmarkerclick",value:function onmarkerclick(e){var iw=this.findInfoWindow("tap");iw&&this.openInfoWindow(iw);this.trigger("click",e)}},{key:"onmarkermouseover",value:function onmarkermouseover(e){var iw=this.findInfoWindow("hover");iw&&this.openInfoWindow(iw)}},{key:"onmarkermouseout",value:function onmarkermouseout(e){var iw=this.findInfoWindow("hover");iw&&this.infoWindow.close()}},{key:"_draw",value:function _draw(context){var _model=this.model,top=_model.top,left=_model.left,width=_model.width,height=_model.height;context.translate(left,top);context.beginPath();context.moveTo(width/2,height*.9);context.bezierCurveTo(width/2.3,height*.6,0,height/2,0,height/4);context.ellipse(width/2,height/4,width/2,height/4,0,Math.PI*1,Math.PI*0);context.bezierCurveTo(width,height/2,width/1.7,height*.6,width/2,height*.9);context.closePath();context.translate(-left,-top)}},{key:"findMap",value:function findMap(id){id=id||this.get("targetMap");return id&&this.root.findById(id)}},{key:"onchange",value:function onchange(after,before){if(before.targetMap){var map=this.findMap(before.targetMap);map&&map.removeMarker(this)}if(after.targetMap){var map=this.findMap(after.targetMap);var marker=map&&map.addMarker(this)}_get(GMapMarker.prototype.__proto__||Object.getPrototypeOf(GMapMarker.prototype),"onchange",this)&&_get(GMapMarker.prototype.__proto__||Object.getPrototypeOf(GMapMarker.prototype),"onchange",this).call(this,after,before)}},{key:"infoWindow",get:function get(){if(!this._infoWindow)this._infoWindow=new google.maps.InfoWindow;return this._infoWindow}},{key:"marker",set:function set(marker){if(this._marker){this._marker.setMap(null);google.maps.event.clearInstanceListeners(this._marker);delete this._marker}if(marker){marker.addListener("click",this.onmarkerclick.bind(this));marker.addListener("mouseover",this.onmarkermouseover.bind(this));marker.addListener("mouseout",this.onmarkermouseout.bind(this));this._marker=marker}}},{key:"hidden",get:function get(){return _get(GMapMarker.prototype.__proto__||Object.getPrototypeOf(GMapMarker.prototype),"hidden",this)||this.app.isViewMode},set:function set(hidden){_set(GMapMarker.prototype.__proto__||Object.getPrototypeOf(GMapMarker.prototype),"hidden",hidden,this)}},{key:"controls",get:function get(){}},{key:"click_handler",get:function get(){if(!this._click_handler)this._click_handler=this.onmarkerclick.bind(this);return this._click_handler}},{key:"latlng",get:function get(){return{lat:this.get("lat"),lng:this.get("lng")}},set:function set(latlng){this.set(latlng)}},{key:"nature",get:function get(){return NATURE}}]);return GMapMarker}(RectPath(Shape));exports.default=GMapMarker;Component.register("gmap-marker",GMapMarker)},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var NATURE={mutable:false,resizable:true,rotatable:true,properties:[{type:"number",label:"latitude",name:"lat",property:"lat"},{type:"number",label:"longitude",name:"lng",property:"lng"},{type:"number",label:"zoom",name:"zoom",property:"zoom"},{type:"string",label:"api-key",name:"apiKey",property:"apiKey"}],"value-property":"latlng"};var _scene=scene,HTMLOverlayContainer=_scene.HTMLOverlayContainer;function getGlobalScale(component){var scale={x:1,y:1};var parent=component;while(parent){var _ref=parent.get("scale")||{x:1,y:1},x=_ref.x,y=_ref.y;scale.x*=x||1;scale.y*=y||1;parent=parent.parent}return scale}var GoogleMap=function(_HTMLOverlayContainer){_inherits(GoogleMap,_HTMLOverlayContainer);function GoogleMap(){_classCallCheck(this,GoogleMap);return _possibleConstructorReturn(this,(GoogleMap.__proto__||Object.getPrototypeOf(GoogleMap)).apply(this,arguments))}_createClass(GoogleMap,[{key:"ready",value:function ready(){_get(GoogleMap.prototype.__proto__||Object.getPrototypeOf(GoogleMap.prototype),"ready",this).call(this);if(this.rootModel){this._listenTo=this.rootModel;this._listener=function(after){after.scale&&this.rescale()}.bind(this);this.rootModel.on("change",this._listener)}}},{key:"removed",value:function removed(){if(this._listenTo){this._listenTo.off("change",this._listener);delete this._listenTo;delete this._listener}}},{key:"rescale",value:function rescale(){var anchor=this._anchor;if(!anchor)return;var scale=getGlobalScale(this);var sx=1/scale.x;var sy=1/scale.y;var transform="scale("+sx+", "+sy+")";["-webkit-","-moz-","-ms-","-o-",""].forEach(function(prefix){anchor.style[prefix+"transform"]=transform;anchor.style[prefix+"transform-origin"]="0px 0px"});var _model=this.model,width=_model.width,height=_model.height;anchor.style.width=width*scale.x+"px";anchor.style.height=height*scale.y+"px";if(GoogleMap.loaded){google.maps.event.trigger(this.map,"resize");this.map.setCenter({lat:this.model.lat,lng:this.model.lng})}}},{key:"createElement",value:function createElement(){_get(GoogleMap.prototype.__proto__||Object.getPrototypeOf(GoogleMap.prototype),"createElement",this).call(this);this._anchor=document.createElement("div");this.element.appendChild(this._anchor);this.rescale();this._markerComponents=[];this._markers=[];this._onmarkerchange=this.onmarkerchange.bind(this);GoogleMap.load(this)}},{key:"onload",value:function onload(){var map=this.map;this.buildMarkers();this.rescale()}},{key:"dispose",value:function dispose(){var _this2=this;_get(GoogleMap.prototype.__proto__||Object.getPrototypeOf(GoogleMap.prototype),"dispose",this).call(this);this._markerComponents&&this._markerComponents.slice().forEach(function(component){_this2.removeMarker(component)});delete this._markerComponents;delete this._markers;delete this._anchor}},{key:"buildMarkers",value:function buildMarkers(){var _this3=this;var markers=[];this._markerComponents.forEach(function(component){var _component$model=component.model,lat=_component$model.lat,lng=_component$model.lng;var marker=new google.maps.Marker({position:{lat:lat,lng:lng},map:_this3.map});markers.push(marker);component.marker=marker});this._markers=markers}},{key:"touchMarker",value:function touchMarker(component){var idx=this._markerComponents.indexOf(component);if(idx==-1||!GoogleMap.loaded)return;var marker=this._markers[idx];var _component$model2=component.model,lat=_component$model2.lat,lng=_component$model2.lng;marker.setPosition(new google.maps.LatLng(lat,lng))}},{key:"onmarkerchange",value:function onmarkerchange(after,before,hint){var component=hint.origin;if(after.hasOwnProperty("lat")||after.hasOwnProperty("lng"))this.touchMarker(component)}},{key:"addMarker",value:function addMarker(component){if(!this._markerComponents)this._markerComponents=[];var markerComponents=this._markerComponents;var markers=this._markers;if(markerComponents.indexOf(component)==-1){markerComponents.push(component);component.on("change",this._onmarkerchange);if(!GoogleMap.loaded)return;var _component$model3=component.model,lat=_component$model3.lat,lng=_component$model3.lng;var marker=new google.maps.Marker({position:{lat:lat,lng:lng},map:this.map});markers.push(marker);markers.push(marker);component.marker=marker}}},{key:"removeMarker",value:function removeMarker(component){if(!this._markerComponents)return;var idx=this._markerComponents.indexOf(component);if(idx==-1)return;component.off("change",this._onmarkerchange);component.marker=null;this._markerComponents.splice(idx,1);var removals=this._markers.splice(idx,1)}},{key:"setElementProperties",value:function setElementProperties(div){this.rescale()}},{key:"onchange",value:function onchange(after,before){if(GoogleMap.loaded){if(after.zoom)this.map.setZoom(after.zoom);if(after.hasOwnProperty("lat")||after.hasOwnProperty("lng")){var _model2=this.model,lat=_model2.lat,lng=_model2.lng;this.map.setCenter(new google.maps.LatLng(lat,lng))}}_get(GoogleMap.prototype.__proto__||Object.getPrototypeOf(GoogleMap.prototype),"onchange",this).call(this,after,before);this.rescale()}},{key:"tagName",get:function get(){return"div"}},{key:"map",get:function get(){if(!this._map){var _model3=this.model,lat=_model3.lat,lng=_model3.lng,zoom=_model3.zoom;this._map=new google.maps.Map(this._anchor,{zoom:zoom,center:{lat:lat,lng:lng}})}return this._map}},{key:"markers",get:function get(){if(!this._markerComponents){this._markerComponents=[];this._markers=[]}return this._markers}},{key:"latlng",get:function get(){return{lat:this.get("lat"),lng:this.get("lng")}},set:function set(latlng){this.set(latlng)}},{key:"nature",get:function get(){return NATURE}}],[{key:"load",value:function load(component){if(GoogleMap.loaded){component.onload();return}if(this.script){GoogleMap.readies.push(component);return}this.readies=[component];var script=document.createElement("script");script.onload=function(){GoogleMap.loaded=true;GoogleMap.readies.forEach(function(component){return component.onload()});delete GoogleMap.readies};var key=component.get("apiKey");script.src="https://maps.googleapis.com/maps/api/js"+(key?"?key="+key:"");document.head.appendChild(script);GoogleMap.script=script}}]);return GoogleMap}(HTMLOverlayContainer);exports.default=GoogleMap;scene.Component.register("google-map",GoogleMap)},{}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _googleMap=require("./google-map");Object.defineProperty(exports,"GoogleMap",{enumerable:true,get:function get(){return _interopRequireDefault(_googleMap).default}});var _gmapMarker=require("./gmap-marker");Object.defineProperty(exports,"GMapMarker",{enumerable:true,get:function get(){return _interopRequireDefault(_gmapMarker).default}});function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./gmap-marker":1,"./google-map":2}]},{},[3]);