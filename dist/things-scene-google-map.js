!function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t){e.exports=scene},function(e,t,r){e.exports=r(2)},function(e,t,r){"use strict";r.r(t);var n=r(0);const a={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"number",label:"latitude",name:"lat"},{type:"number",label:"longitude",name:"lng"},{type:"number",label:"zoom",name:"zoom"},{type:"string",label:"api-key",name:"apiKey"}],"value-property":"latlng"};class i extends n.HTMLOverlayContainer{static load(e){var t=e.get("apiKey");n.ScriptLoader.load("https://maps.googleapis.com/maps/api/js"+(t?"?key="+t:"")).then(()=>e.onload(),n.error)}ready(){super.ready(),this.rootModel&&(this._listenTo=this.rootModel,this._listener=function(e){e.scale&&this.rescale()}.bind(this),this.rootModel.on("change",this._listener))}removed(){this._listenTo&&(this._listenTo.off("change",this._listener),delete this._listenTo,delete this._listener)}rescale(){var e=this._anchor;if(e){var t=function(e){for(var t={x:1,y:1},r=e;r;){let{x:e,y:n}=r.get("scale")||{x:1,y:1};t.x*=e||1,t.y*=n||1,r=r.parent}return t}(this),r=`scale(${1/t.x}, ${1/t.y})`;["-webkit-","-moz-","-ms-","-o-",""].forEach(t=>{e.style[t+"transform"]=r,e.style[t+"transform-origin"]="0px 0px"});var{width:n,height:a}=this.model;e.style.width=n*t.x+"px",e.style.height=a*t.y+"px",i.loaded&&(google.maps.event.trigger(this.map,"resize"),this.map.setCenter({lat:this.model.lat,lng:this.model.lng}))}}createElement(){super.createElement(),this._anchor=document.createElement("div"),this.element.appendChild(this._anchor),this.rescale(),this._markerComponents=[],this._markers=[],this._onmarkerchange=this.onmarkerchange.bind(this),i.load(this)}onload(){i.loaded=!0;this.map;this.buildMarkers(),this.rescale()}get tagName(){return"div"}get map(){if(!this._map){var{lat:e,lng:t,zoom:r}=this.model;this._map=new google.maps.Map(this._anchor,{zoom:r,center:{lat:e,lng:t}})}return this._map}dispose(){super.dispose(),this._markerComponents&&this._markerComponents.slice().forEach(e=>{this.removeMarker(e)}),delete this._markerComponents,delete this._markers,delete this._anchor}buildMarkers(){var e=[];this._markerComponents.forEach(t=>{let{lat:r,lng:n}=t.model,a=new google.maps.Marker({position:{lat:r,lng:n},map:this.map});e.push(a),t.marker=a}),this._markers=e}touchMarker(e){var t=this._markerComponents.indexOf(e);if(-1!=t&&i.loaded){var r=this._markers[t],{lat:n,lng:a}=e.model;r.setPosition(new google.maps.LatLng(n,a))}}onmarkerchange(e,t,r){var n=r.origin;(e.hasOwnProperty("lat")||e.hasOwnProperty("lng"))&&this.touchMarker(n)}addMarker(e){this._markerComponents||(this._markerComponents=[]);var t=this._markerComponents,r=this._markers;if(-1==t.indexOf(e)){if(t.push(e),e.on("change",this._onmarkerchange),!i.loaded)return;let{lat:n,lng:a}=e.model,o=new google.maps.Marker({position:{lat:n,lng:a},map:this.map});r.push(o),e.marker=o}}removeMarker(e){if(this._markerComponents){var t=this._markerComponents.indexOf(e);if(-1!=t){e.off("change",this._onmarkerchange),e.marker=null,this._markerComponents.splice(t,1);this._markers.splice(t,1)}}}get markers(){return this._markerComponents||(this._markerComponents=[],this._markers=[]),this._markers}setElementProperties(e){this.rescale()}onchange(e,t){if(i.loaded&&(e.zoom&&this.map.setZoom(e.zoom),e.hasOwnProperty("lat")||e.hasOwnProperty("lng"))){let{lat:e,lng:t}=this.model;this.map.setCenter(new google.maps.LatLng(e,t))}super.onchange(e,t),this.rescale()}get latlng(){return{lat:this.get("lat"),lng:this.get("lng")}}set latlng(e){this.set(e)}get nature(){return a}}n.Component.register("google-map",i);const o={mutable:!1,resizable:!0,rotatable:!0,properties:[{type:"string",label:"target-map",name:"targetMap"},{type:"number",label:"latitude",name:"lat"},{type:"number",label:"longitude",name:"lng"}],"value-property":"latlng"};class s extends(Object(n.RectPath)(n.Shape)){dispose(){var e=this.findMap();e&&e.removeMarker(this),delete this._infoWindow,delete this._marker,super.dispose()}ready(){super.ready();var e=this.findMap();e&&e.addMarker(this)}get infoWindow(){return this._infoWindow||(this._infoWindow=new google.maps.InfoWindow),this._infoWindow}findInfoWindow(e){var t=this.model.event,r=t&&t[e]&&t[e].infoWindow;if(r)return this.root.findById(r)}setInfoContent(e){var t=n.Component.template(e.model.frontSideTemplate),r=`<style>${e.model.style}</style>`+t(this);this.infoWindow.setContent(r)}openInfoWindow(e){this.setInfoContent(e);var t=this.findMap();t&&t.map&&this.infoWindow.open(t.map,this._marker)}onmarkerclick(e){var t=this.findInfoWindow("tap");t&&this.openInfoWindow(t),this.trigger("click",e)}onmarkermouseover(e){var t=this.findInfoWindow("hover");t&&this.openInfoWindow(t)}onmarkermouseout(e){this.findInfoWindow("hover")&&this.infoWindow.close()}set marker(e){this._marker&&(this._marker.setMap(null),google.maps.event.clearInstanceListeners(this._marker),delete this._marker),e&&(e.addListener("click",this.onmarkerclick.bind(this)),e.addListener("mouseover",this.onmarkermouseover.bind(this)),e.addListener("mouseout",this.onmarkermouseout.bind(this)),this._marker=e)}get hidden(){return super.hidden||this.app.isViewMode}set hidden(e){super.hidden=e}_draw(e){var{top:t,left:r,width:n,height:a}=this.model;e.translate(r,t),e.beginPath(),e.moveTo(n/2,.9*a),e.bezierCurveTo(n/2.3,.6*a,0,a/2,0,a/4),e.ellipse(n/2,a/4,n/2,a/4,0,1*Math.PI,0*Math.PI),e.bezierCurveTo(n,a/2,n/1.7,.6*a,n/2,.9*a),e.closePath(),e.translate(-r,-t)}get controls(){}findMap(e){return(e=e||this.get("targetMap"))&&this.root.findById(e)}get click_handler(){return this._click_handler||(this._click_handler=this.onmarkerclick.bind(this)),this._click_handler}onchange(e,t){t.targetMap&&((r=this.findMap(t.targetMap))&&r.removeMarker(this));if(e.targetMap){var r;(r=this.findMap(e.targetMap))&&r.addMarker(this)}super.onchange&&super.onchange(e,t)}get latlng(){return{lat:this.get("lat"),lng:this.get("lng")}}set latlng(e){this.set(e)}get nature(){return o}}n.Component.register("gmap-marker",s),r.d(t,"GoogleMap",function(){return i}),r.d(t,"GMapMarker",function(){return s})}]);
//# sourceMappingURL=things-scene-google-map.js.map